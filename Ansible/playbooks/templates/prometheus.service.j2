[Unit]
Description=Prometheus Monitoring Server
Documentation=https://prometheus.io/docs/introduction/overview/
Wants=network-online.target
After=network-online.target

[Service]
Type=simple
User=prometheus
Group=prometheus
Restart=on-failure
RestartSec=5s

ExecStart=/usr/local/bin/prometheus \
  --config.file={{ prometheus_config_dir | default('/etc/prometheus') }}/prometheus.yml \
  --storage.tsdb.path={{ prometheus_data_dir | default('/var/lib/prometheus') }} \
  --storage.tsdb.retention.time=30d \
  --storage.tsdb.retention.size=10GB \
  --web.listen-address=0.0.0.0:9090 \
  --web.console.templates={{ prometheus_config_dir | default('/etc/prometheus') }}/consoles \
  --web.console.libraries={{ prometheus_config_dir | default('/etc/prometheus') }}/console_libraries \
  --web.enable-lifecycle \
  --log.level=info

ExecReload=/bin/kill -HUP $MAINPID

# Security hardening
NoNewPrivileges=yes
ProtectSystem=full
ProtectHome=yes
ReadWritePaths={{ prometheus_data_dir | default('/var/lib/prometheus') }}

[Install]
WantedBy=multi-user.target
